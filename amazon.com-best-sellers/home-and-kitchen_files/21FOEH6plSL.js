(function(u){var B=window.AmazonUIPageJS||window.P,D=B._namespace||B.attributeErrors,b=D?D("DigitalMusicWebsitePrimeAssets"):B;b.guardFatal?b.guardFatal(u)(b,window):b.execute(function(){u(b,window)})})(function(u,B,D){u.when("A","a-modal","dm-metrics").register("dmusic_webstore_prime",function(b,a,m){function n(a){"object"===typeof a&&"object"===typeof a.button&&(a.button.addClass("aok-hidden"),0<b.$("#dmusic_tracklist_player_container").length?a.button.siblings().removeClass("aok-hidden"):(a.button.siblings("span[id^=dmusic_tracklist_play_]").removeClass("aok-hidden"),
a.button.siblings().children("span[id^=dmusic_tracklist_play_]").removeClass("aok-hidden")),b.$("#dmusic_library_button_box .robinPlayButton."+a.asin).removeClass("aok-hidden"),a.button.siblings("#PrimeUpsellInstruction").addClass("aok-hidden"),a.status=1)}function k(){var c=a.get(b.$("#cross_fulfillment_modal"));c.lock().show();b.$("#cross_fulfillment_close_button").click(function(){c.unlock().hide()});b.$("#cross_fulfillment_fix_button").click(function(){c.unlock().hide();B.location="https://"+
B.location.hostname+"/gp/dmusic/account/settings/ref=dm_rw_pp_kcf_fix"});return!1}var r={modalElm:null,popup:function(b){this.modalElm=a.create("<span>",{activate:"onclick",closeButton:!1,dataStrategy:"ajax",name:"touModal",url:"/gp/dmusic/modalPurchasing/touModal?ASIN="+b,width:500});this.modalElm.lock(20).show()},close:function(){this.modalElm&&(this.modalElm.unlock(20),a.remove(this.modalElm))}},f={recordAddATLContent:function(a,b){if("playlist"!==a.type){var d=a.selectionSourceType;d||(d="track"===
a.type?a.source:"");d={linkType:a.type.toUpperCase(),asin:a.asin,contentSubscriptionMode:b,pageType:"Detail",selectionSourceType:d,selectionSourceId:"track"===a.type?a.sourceId:""};m.reportClickedAddContent(d)}}},g=function(a){if("object"===typeof a){this.button=a;this.status=0;var b=a.find("button");0===b.length&&(b=a.find("a"));0===b.length&&(b=a);this.asin=b.attr("data-asin");this.parentAsin=b.attr("data-parentAsin");this.csrf_session=b.attr("data-session");this.type=b.attr("data-type")?b.attr("data-type"):
"track";this.callback=b.attr("data-callback");this.title=b.attr("data-title")?b.attr("data-title"):"The "+this.type;this.client=b.attr("data-client")?b.attr("data-client"):"dm_dp";this.source="search"===this.client?"SEARCH":b.attr("data-source");this.sourceId=b.attr("data-sourceId");this.ref=b.attr("data-ref")?b.attr("data-ref"):"dm_ws_xx_xx_xx_aart_xx_xx";this.legacyMTS=b.attr("data-legacyMTS");a=b.attr("data-autoAdd");1!==a&&"1"!==a||this.addToLib()}},d={buttonHash:{},parentHash:{},add:function(a){for(var d=
0,f=a.length;d<f;++d){var k=new g(b.$(a[d]));this.buttonHash[k.asin]||(this.buttonHash[k.asin]=[]);this.buttonHash[k.asin].push(k);"track"===k.type&&"string"===typeof k.parentAsin&&(this.parentHash[k.parentAsin]||(this.parentHash[k.parentAsin]=[]),this.parentHash[k.parentAsin].push(k))}d=function(a){var c=(new g(b.$(this))).addToLib();c&&a.preventDefault();return!c};b.$.isFunction(a.live)?a.live("click",d):a.click(d)},register:function(){this.add(b.$(".robinAddButton:not(.CloudPlayerDirectLink)"))}};
g.prototype.addToLib=function(){if(this.asin===D||this.csrf_session===D)return!1;var a="playlist"===this.type?"/gp/dmusic/playlist/utility/follow_playlist.html/ref="+this.ref:"/gp/dmusic/buyBox/utility/add_to_library.html/ref="+this.ref,d="asin="+this.asin+"&sessionid="+this.csrf_session+"&acceptsTOU="+(1===this.acceptsTOU||"1"===this.acceptsTOU?1:0);"playlist"!==this.type||1!==this.acceptedTOU&&"1"!==this.acceptedTOU||(d+="&acceptedTOU=1");var g=this;b.$.ajax({url:a,data:d,success:function(a){var b=
a.status;if((0===b||"0"===b)&&a.hasOwnProperty("exception")){if("AccountNotVerifiedException"===a.exception){a="/gp/dmusic/verification/addCreditCardMP3?robinPath=1&asin.0="+g.asin;a+="&returnUrl="+encodeURIComponent(B.location);B.location=a;return}if("InvalidTermsOfUseException"===a.exception){if("search"===g.client){location.href="/gp/product/"+g.asin+"/ref=dm_s_rb?autoAdd=1";return}r.popup(g.asin);return}if("CrossMarketplaceCloudPlayerHomeException"===a.exception){k();return}}1!==a.status&&"1"!==
a.status||f.recordAddATLContent(g,a.contentSubMode);"string"===typeof g.callback&&(b=B[g.callback],"function"===typeof b&&b(a,g))},dataType:"json",type:"POST",async:1,timeout:5E3});return!0};u.when("dmusic_webstore_app_upsell").execute(function(a){b.$.ajax({url:"/gp/dmusic/modalPurchasing/utility/is-appupsell-eligible.html",cache:!1,success:function(b){1===b.isAppUpsellEligible&&(a.AppUpsell.modal.shouldShow=!0)},error:function(a){}})});return{DigitalMusicRobinBtnManager:d,DigitalMusicRobinMetrics:f,
DigitalMusicTOUModal:r,robinToggleToPlayButton:function(a,b){if("object"===typeof a&&a.hasOwnProperty("status")&&"object"===typeof b){var f=a.status;if(1===f||"1"===f){if("object"===typeof b.button)if("object"===typeof d){f=d.buttonHash;if("object"===typeof f){var g=d.buttonHash[b.asin];if("object"===typeof g)for(var k=0;k<g.length;++k)"object"===typeof g[k]&&n(g[k]);else n(b)}g=d.parentHash;if("object"===typeof g)if("album"===b.type){if(f=g[b.asin],"object"===typeof f)for(var m in f)"object"===typeof f[m]&&
n(f[m])}else if("track"===b.type&&"string"===typeof b.parentAsin)if(g=g[b.parentAsin],"object"===typeof g){k=!0;for(m in g)if("object"===typeof g[m]&&(0===g[m].status||"0"===g[m])){k=!1;break}if(k&&"object"===typeof f&&(f=d.buttonHash[b.parentAsin],"object"===typeof f))for(m in f)"object"===typeof f[m]&&n(f[m])}else n(b)}else n(b);u.when("dmusic_webstore_app_upsell").execute(function(a){a=a.AppUpsell.modal;a.shouldShow&&(a.show(),a.shouldShow=!1)})}}},digitalMusicAddToLibByAsin:function(a,b){if("object"===
typeof d&&"object"===typeof d.buttonHash){var f=d.buttonHash[a];if("object"===typeof f&&0<f.length){if(1===b||"1"===b)f[0].acceptsTOU=1;f[0].addToLib()}}}}})});