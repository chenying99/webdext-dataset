(function(u){var B=window.AmazonUIPageJS||window.P,D=B._namespace||B.attributeErrors,b=D?D("DigitalMusicWebsiteCartAssets"):B;b.guardFatal?b.guardFatal(u)(b,window):b.execute(function(){u(b,window)})})(function(u,B,D){u.when("A").register("dmusic_webstore_music_cart",function(b){function a(){b.$.ajax({url:"/gp/dmusic/modalPurchasing/utility/cart-as-json.html",type:"POST",dataType:"json",cache:!1,success:function(a){b.$(".nav-subnavFlyout.nav-subnavFlyout-nudged .nav-flyout-content").html(a["subnav-dmusic-flyout-cart"].html)}})}
function m(e){var f="dm_ws_unknwn_a2c_"+e.asin;"buyBox"===e.loc?f="dm_ws_bb_a2c":"tracklistPlayer"===e.loc?f="dm_ws_tlw_a2c":"search"===e.loc&&(f="dm_ext_s_a2c");e.refMarker&&(f=e.refMarker);var g=e.qid,k=e.sr;if(null===g||g===D)g=/[\?&]qid=([^&#]*)/.exec(location.search),null!==g&&g!==D&&(g=g[1]);if(null===k||k===D)k=/[\?&]sr=([^&#]*)/.exec(location.search),null!==k&&k!==D&&(k=k[1]);f={url:"/gp/dmusic/purchase/utility/add-to-cart.html/ref="+f,data:{ASIN:e.asin},type:"POST",dataType:"json",cache:!1};
null!==g&&g!==D&&(f.data.qid=g);null!==k&&k!==D&&(f.data.sr=k);f.success=function(b){if(b&&b.cartInfo&&b.success){var f=b.cartInfo.CheckedCartSize||0,f=f+(b.cartInfo.UncheckedCartSize||0);d(f);e.title&&"ok"===b.success||"errorInputOverflow"!==b.success&&"errorMusicCartOverflow"!==b.success||c(e);e.success="ok"===b.success?!0:!1;a()}else e.success=!1;b=e.callback;if("function"===typeof B[b])B[b](e)};f.error=function(a){e.success=!1;var b=e[b];if("function"===typeof B[b])B[b](e)};b.$.ajax(f)}function n(a,
b,c){if("object"!==typeof a)return!0;var d={};d.asin=a.getAttribute("data-asin")||a.getAttribute("value");d.title=a.getAttribute("data-title")||"";d.callback=a.getAttribute("data-callback")||"";d.action="add";d.loc=a.getAttribute("data-location")||"unknown";d.qid=a.getAttribute("data-qid")||D;d.sr=a.getAttribute("data-sr")||D;d.isSignedIn=b;d.event=c;var f="true"===a.getAttribute("data-customerBBOPEligible");return f?(d.clickedButtonType=a.getAttribute("data-clickedButtonType"),d.isAlbum="true"===
a.getAttribute("data-isAlbum"),d.buttonLocationType=a.getAttribute("data-location"),d.customerBBOPEligible=f,c.preventDefault(),u.when("dmusic_webstore_bbop_popup").execute(function(a){a.addToCartHandler(d)}),!1):b&&d.asin?(c.preventDefault(),m(d),!1):!0}function k(c,f){var g="dm_ws_unknwn_rfc_"+c.asin;"buyBox"===c.loc?g="dm_ws_bb_rfc_"+c.asin:"tracklistPlayer"===c.loc&&(g="dm_ws_tlw_rfc_"+c.asin);c.event=f;b.$.ajax({url:"/gp/dmusic/purchase/utility/remove-from-cart.html/ref="+g,data:{ASIN:c.asin},
type:"POST",dataType:"json",cache:!1,success:function(b){if(b&&b.cartInfo&&b.success){var f=b.cartInfo.CheckedCartSize||0,f=f+(b.cartInfo.UncheckedCartSize||0);d(f);c.success=!0;a()}else c.success=!1;b=c.callback;if("function"===typeof B[b])B[b](c)},error:function(a){c.success=!1;a=c.callback;if("function"===typeof B[a])B[a](c)}})}function r(a,b,c){if("object"!==typeof a)return!0;var d={};d.asin=a.getAttribute("data-asin")||a.getAttribute("value");d.title=a.getAttribute("data-title")||"";d.callback=
a.getAttribute("data-callback")||"";d.action="remove";d.loc=a.getAttribute("data-location")||"unknown";return b&&d.asin?(c.preventDefault(),k(d,c),!1):!0}function f(a){var c=b.$(".MusicCartAddButton"),d=b.$(".MusicCartRemoveButton");b.$.isFunction(c.live)?c.live("click",function(b){n(this,a,b)}):c.click(function(b){n(this,a,b)});b.$.isFunction(d.live)?d.live("click",function(b){r(this,a,b)}):d.click(function(b){r(this,a,b)})}function g(a,c){a&&b.$.ajax({url:"/gp/dmusic/purchase/utility/promoHelper.html",
data:{operation:"redeemCode",code:a},type:"POST",dataType:"json",cache:!1,success:function(a){c(a.success)},error:function(a){c("0")}})}var d=function(a){var c=b.$(".MP3CartCounter");0===a||"0"===a?c.remove():"object"===typeof c&&0<c.length?c.text(a):b.$('#nav-subnav[data-category="dmusic"] a[href*="cartReview"]').prepend("<div class='MP3CartCounter'>"+a+"</div>")},c=function(a){b.$("#MusicCartFullToastContainer").stop(!0,!0).fadeIn(200).delay(5E3).fadeOut(200)};return{setCartCount:d,showAddToCartToast:function(a){},
showFullCartToast:c,setupMusicCartButtons:f,setupMusicCartBar:function(a){var c=a&&0!==a.customerId&&"0"!==a.customerId;c&&(a={url:"/gp/dmusic/purchase/utility/get-cart-info.html",type:"POST",dataType:"json",cache:!1,success:function(a){if(a&&a.cartInfo&&a.status){var b=a.cartInfo.CheckedCartSize||0,b=b+(a.cartInfo.UncheckedCartSize||0);d(b)}},error:function(a){}},b.$.ajax(a));f(c);a=b.$(".MusicCartStickyBit");1>a.length||(c=b.$(".MusicCartBarSpacer"),1>c.length&&(c=b.$(".MusicCartBarSpacerFullCSS")),
0<c.length&&(a.css({position:"absolute"}),c.css({display:"inline-block"})),a=b.$(".MusicCartBarSpacer"),"object"!==typeof a||1>a.length||"function"!==typeof a.position||(a=a.position().top,"undefined"!==typeof a&&"function"===typeof a.toString&&(a=function(a){a=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;var c=b.$(".MusicCartBarSpacer").position().top,e=b.$(".MusicCartStickyBit");"undefined"!==typeof a&&a>c?e.css({position:"fixed",top:"0px","box-shadow":"3px 3px 3px rgba(0,0,0,0.1)"}):
e.css({position:"fixed",top:(c-a).toString()+"px","box-shadow":"0px 0px 0px rgba(0,0,0,0.1)"})},b.$(B).scroll(a),a())))},setupReviewList:function(){for(var a=function(a){a||(a=B.event);var c=a.srcElement?a.srcElement:a.target?a.target:null;if("input"===c.nodeName.toLowerCase()){a=c.defaultValue;var c=c.checked,e=b.$("#purchaseASINs");if(e&&0<e.length)if(c)e.attr("value",e.attr("value")+a);else{var d=e.attr("value"),d=d.replace(new RegExp(a,"g"),"");e.attr("value",d)}(e=b.$(".MusicCartReviewListRow"+
a))&&0<e.length&&(c?(e.removeClass("MusicCartReviewListRowUnselected"),e.addClass("MusicCartReviewListRowSelected"),e.find("input").prop("checked",!0)):(e.addClass("MusicCartReviewListRowUnselected"),e.removeClass("MusicCartReviewListRowSelected"),e.find("input").prop("checked",!1)));e=b.$(".MusicCartReviewListCurrentSelectedCounter");0<e.length&&(c?e.text(parseInt(e.first().text(),10)+1):0<parseInt(e.first().text(),10)&&e.text(parseInt(e.first().text(),10)-1),2>parseInt(e.first().text(),10)&&b.$(".MusicCartReviewListCurrentSelectedSingleCounter").text(c?
1:0),d=b.$(".MusicCartReviewContinueButton"),"object"===typeof d&&0<d.length&&(1>parseInt(e.first().text(),10)?d.addClass("a-button-disabled"):d.removeClass("a-button-disabled")),d=b.$("#modalEditCartCheckoutButton"),"object"===typeof d&&0<d.length&&(1>parseInt(e.first().text(),10)?d.addClass("a-button-disabled"):d.removeClass("a-button-disabled")));d=b.$("#"+a+"Checkbox");e=b.$(".OrderSubtotal");if(0<d.length&&0<e.length){var f=d.attr("data-price");if(f){var g=d=!1;/￥/.test(e.first().text())&&(d=
!0);/EUR/.test(e.first().text())&&(g=!0);var k=e.first().text().match(/\d.*/);g&&(k=k.toString().replace(",","."));d&&(k=k.toString().replace(",",""));f=c?e.first().text().replace(/\d.*/,(parseFloat(k)+parseFloat(f)).toFixed(2)):e.first().text().replace(/\d.*/,(parseFloat(k)-parseFloat(f)).toFixed(2));g&&(f=f.toString().replace(".",","));d&&(f=f.toString().replace(".00",""),f=f.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));e.text(f);g=d=!1}}e="dm_ws_ec_"+(c?"ck":"uck")+(0<b.$(".ModalPurchase").length?
"_mdl":"_fl");e={url:"/gp/dmusic/purchase/utility/check-uncheck-asin.html/ref="+e,data:{},type:"POST",dataType:"json",cache:!1};c?e.data.checkASINs=a:e.data.uncheckASINs=a;e.success=function(a){};e.error=function(a){};b.$.ajax(e)}},c=function(a){var c=a.value.toString();a=a.checked;var e=b.$("#purchaseASINs");if(e&&0<e.length)if(a)e.attr("value",e.attr("value")+c);else{var d=e.attr("value"),d=d.replace(new RegExp(c,"g"),"");e.attr("value",d)}e=b.$(".MusicCartReviewListRow"+c);0<e.length&&(a?(e.removeClass("MusicCartReviewListRowUnselected"),
e.addClass("MusicCartReviewListRowSelected"),e.find("input").prop("checked",!0)):(e.addClass("MusicCartReviewListRowUnselected"),e.removeClass("MusicCartReviewListRowSelected"),e.find("input").prop("checked",!1)));e=b.$(".MusicCartReviewListCurrentSelectedCounter");0<e.length&&(a?e.text(parseInt(e.first().text(),10)+1):0<parseInt(e.first().text(),10)&&e.text(parseInt(e.first().text(),10)-1),2>parseInt(e.first().text(),10)&&b.$(".MusicCartReviewListCurrentSelectedSingleCounter").text(a?1:0),d=b.$(".MusicCartReviewContinueButton"),
"object"===typeof d&&0<d.length&&(1>parseInt(e.first().text(),10)?d.addClass("a-button-disabled"):d.removeClass("a-button-disabled")),d=b.$("#modalEditCartCheckoutButton"),"object"===typeof d&&0<d.length&&(1>parseInt(e.first().text(),10)?d.addClass("a-button-disabled"):d.removeClass("a-button-disabled")));e=b.$("#"+c+"Checkbox");c=b.$(".OrderSubtotal");if(0<e.length&&0<c.length){var f=e.attr("data-price");if(f){d=e=!1;/￥/.test(c.first().text())&&(e=!0);/EUR/.test(c.first().text())&&(d=!0);var g=c.first().text().match(/\d.*/);
d&&(g=g.toString().replace(",","."));e&&(g=g.toString().replace(",",""));a=a?c.first().text().replace(/\d.*/,(parseFloat(g)+parseFloat(f)).toFixed(2)):c.first().text().replace(/\d.*/,(parseFloat(g)-parseFloat(f)).toFixed(2));d&&(a=a.toString().replace(".",","));e&&(a=a.toString().replace(".00",""),a=a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));c.text(a)}}},d=function(a){for(var e="",d=0;d<a.length;d++)a[d].checked||(e+=a[d].value.toString(),a[d].checked=!0,c(a[d]));a="dm_ws_ec_sa"+(0<b.$(".ModalPurchase").length?
"_mdl":"_fl");b.$.ajax({url:"/gp/dmusic/purchase/utility/check-uncheck-asin.html/ref="+a,data:{checkASINs:e},type:"POST",dataType:"json",cache:!1,success:function(a){b.$("#MusicCartSelectAllLink").hide()},error:function(a){}})},f=b.$("#MusicCartSelectAllLink"),g=b.$(".MusicCartReviewListActualCheckbox").find("input:checkbox"),m=b.$(".MusicCartReviewListFullPageActualCheckbox").find("input:checkbox"),n=0;n<g.length;n++)if(!g[n].checked){f.show();break}for(n=0;n<m.length;n++)if(!m[n].checked){f.show();
break}f.unbind("click");f.click(function(){g=b.$(".MusicCartReviewListActualCheckbox").find("input:checkbox");m=b.$(".MusicCartReviewListFullPageActualCheckbox").find("input:checkbox");0!==g.length?d(g):0!==m.length&&d(m)});g.unbind("click");g.click(function(){this.checked?g.length===b.$(".MusicCartReviewListActualCheckbox").find("input:checkbox:checked").length&&f.hide():f.show()});m.unbind("click");m.click(function(){this.checked?m.length===b.$(".MusicCartReviewListFullPageActualCheckbox").find("input:checkbox:checked").length&&
f.hide():f.show()});(n=b.$(".MusicCartReviewListCheckHidden"))&&0<n.length&&(n.removeClass("MusicCartReviewListCheckHidden"),n.addClass("MusicCartReviewListCheck"),n=b.$(".MusicCartReviewListActualCheckbox"),n.unbind("click"),n.click(a),n=b.$(".MusicCartReviewListFullPageActualCheckbox"),n.unbind("click"),n.click(a));a=function(a){if(1!==b.$(".MusicCartReviewListDeleteLink").length){a||(a=B.event);var c=a.srcElement?a.srcElement:a.target?a.target:null,e=c.getAttribute("data-asin"),d=c.getAttribute("data-callback");
if(e&&(a.preventDefault(),k({asin:e,callback:d}),(a=b.$("#purchaseASINs"))&&0<a.length&&(d=a.attr("value"),d=d.replace(new RegExp(e,"g"),""),a.attr("value",d)),(a=b.$(".MusicCartReviewListRow"+e.toString()))&&0<a.length)){a.find(".MusicCartReviewListActualCheckbox").removeClass("MusicCartReviewListActualCheckbox");a.find(".MusicCartReviewListFullPageActualCheckbox").removeClass("MusicCartReviewListFullPageActualCheckbox");a.hide();a.next().hasClass("MusicCartReviewListDivider")||a.next().hasClass("MusicCartReviewListFullPageDivider")?
a.next().hide():(a.prev().hasClass("MusicCartReviewListDivider")||a.prev().hasClass("MusicCartReviewListFullPageDivider"))&&a.prev().hide();var f=b.$(".MusicCartReviewListCounter"),d=b.$(".MusicCartReviewListCurrentSelectedCounter");a=b.$(".MusicCartReviewListCurrentTotalCounter");var g=b.$("#"+e+"Checkbox").find("input:checkbox");f&&0<f.length&&(f.text(parseInt(f.first().text(),10)-1),a.text(parseInt(f.first().text(),10)),0<parseInt(d.first().text(),10)&&g.is(":checked")&&d.text(parseInt(d.first().text(),
10)-1),"1"===f.first().text()&&(b.$(".MusicCartReviewListMultiItem").hide(),b.$(".MusicCartReviewListSingleItem").show()),"0"===f.first().text()&&(b.$(".MusicCartReviewListMultiItem").hide(),b.$(".MusicCartReviewListSingleItem").hide()));e=c.getAttribute("data-price");c=b.$(".OrderSubtotal");if(e&&c&&0<c.length&&g.is(":checked")){var m=c.first().text().match(/\d.*/),f=g=!1;/￥/.test(c.first().text())&&(g=!0);/EUR/.test(c.first().text())&&(f=!0);f&&(m=m.toString().replace(",","."));g&&(m=m.toString().replace(",",
""));e=c.first().text().replace(/\d.*/,(parseFloat(m)-parseFloat(e)).toFixed(2));f&&(e=e.toString().replace(".",","));g&&(e=e.toString().replace(".00",""),e=e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));c.text(e)}c=b.$(".MusicCartReviewContinueButton");e=b.$("#modalEditCartCheckoutButton");1>parseInt(d.first().text(),10)?(c.addClass("a-button-disabled"),e.addClass("a-button-disabled")):(c.removeClass("a-button-disabled"),e.removeClass("a-button-disabled"));d=b.$("#MusicCartReviewItemsSelected");
c=b.$("#MusicCartReviewItemSelected");e=b.$(".MusicCartReviewButtonBox");0===a.length||1>parseInt(a.first().text(),10)?(d.hide(),c.hide(),e&&B.location.replace("/gp/dmusic/purchase/emptyCart/ref=dm_ws_ec_dli")):1===parseInt(a.first().text(),10)?(a=b.$(".MusicCartReviewListActualCheckbox").find("input:checkbox"),0===a.length&&(a=b.$(".MusicCartReviewListFullPageActualCheckbox").find("input:checkbox")),b.$(".MusicCartReviewListCurrentSelectedSingleCounter").text(a.is(":checked")?1:0),d.hide(),c.show()):
(c.hide(),d.show())}}};(n=b.$(".MusicCartReviewListDeleteLink"))&&0<n.length&&(n.unbind("click"),n.click(a));a=b.$(".MusicCartReviewListCurrentSelectedCounter");n=b.$(".MusicCartReviewContinueButton");"object"===typeof n&&0<n.length&&(1>parseInt(a.first().text(),10)?n.addClass("a-button-disabled"):n.removeClass("a-button-disabled"));n=b.$("#modalEditCartCheckoutButton");"object"===typeof n&&0<n.length&&(1>parseInt(a.first().text(),10)?n.addClass("a-button-disabled"):n.removeClass("a-button-disabled"))},
setupPromoEntry:function(){var a=b.$(".PromoEntryField"),c=b.$(".PromoEntryButton");if("object"===typeof a&&0!==a.length&&"object"===typeof c&&0!==c.length){var d=function(){var a=b.$(".PromoEntrySuccess"),c=b.$(".PromoEntryError");"object"===typeof a&&0<a.length&&a.css({display:"inline-block"});"object"===typeof c&&0<c.length&&c.css({display:"none"});a=b.$("#orderAsins");"object"===typeof a&&0!==a.length&&(a={url:"/gp/dmusic/purchase/utility/order-preview-as-string.html/ref=dm_ws_pr_pe",data:{ASIN:a.attr("value")},
type:"POST",dataType:"json",cache:!1,success:function(a){var c=b.$(".MusicCartReviewSubtotalSection");"object"===typeof c&&0<c.length&&c.replaceWith(a.summaryHtml)}},b.$.ajax(a))};c.click(function(){var c=a.val();g(c,function(a){if(a)d();else{a=b.$(".PromoEntrySuccess");var c=b.$(".PromoEntryError");"object"===typeof c&&0<c.length&&c.css({display:"inline-block"});"object"===typeof a&&0<a.length&&a.css({display:"none"})}})});c=b.$(".PromoEntryToggle");"object"===typeof c&&0<c.length&&c.css({display:"inline-block"})}},
addToCart:m}});u.when("A","ready").execute(function(b){b.$(".InCartButton").live("mouseenter",function(a){b.$(this).find(".InCartString").css("display","none");b.$(this).find(".ViewCartString").css("display","block")});b.$(".InCartButton").live("mouseleave",function(a){b.$(this).find(".ViewCartString").css("display","none");b.$(this).find(".InCartString").css("display","block")});b.$("#nav-subnav.spacious .nav-arrow").css("visibility","visible")})});