webpackJsonp([70],{1191:function(t,e,s){t.exports={actions:{adPrefetch:s(212)},controllerViews:{AdPrefetch:s(552),ComboAd:s(551),DockedAds:s(2541),Ad:s(506)},stores:{AdStore:s(27)}}},2540:function(t,e,s){t.exports=function(t,e,i){var n=e.componentProps.id;n?t.executeAction(s(107),{parentComponent:{bundleName:"td-ads",name:"DockedAds"},name:n,components:e.componentProps.children},i):i&&i()}},2541:function(t,e,s){"use strict";var i=s(185).Composite;t.exports=s(4)({displayName:"DockedAds",mixins:[s(14)],propTypes:{className:s(0).string,children:s(0).array.isRequired,target:s(0).string,targetIndex:s(0).number,targetSelector:s(0).string},statics:{initializeAction:s(2540),storeListeners:[s(27)]},contextTypes:{renderTarget:s(0).object},getInitialState:function(t){return this.adStore=this.getStore(s(27)),this.routeStore=this.getStore("RouteStore"),{isFixed:!1,expanded:!1,isFetching:!1,childReady:this.adStore.getChildCompositeReady(this.props.id),childCount:this.props.children.length,right:0,offset:0}},getChildPositions:function(){var t=[];return this.props.children.forEach(function(e){"td-ads"===e.bundleName&&t.push(e.props.pos)}),t},commentExpand:function(t){var e=this,i=t.offsetHeight>250,n=!1,o=this.props.children.length;if(e.state.expanded!==i){var r=e.getChildPositions();t.offsetHeight<650&&(r.splice(1),o=1),t.offsetHeight>250?(n=!0,i&&setImmediate(function(){context.executeAction(s(148),{positions:r}),e._repositionAd(null,!0)})):i=!1}e.setState({expanded:i,isFetching:n,childCount:o})},onChange:function(t){var e=this,i=this.routeStore,n=i.getCurrentNavigate()||{},o=s(2)(n,["params","collapseContent"],!1),r=null;if("childCompositeReady"===t.type&&this.props.id===t.instanceId&&this.setState({childReady:!0}),this.state.expanded&&"task_complete"===t.type&&this.setState({isFetching:!1}),this.props.target){var p=document.getElementsByClassName(this.props.target);p&&p.length>this.props.targetIndex&&(r=p[this.props.targetIndex])}else if(this.props.targetSelector){var a=this.context.renderTarget;r=document.querySelector("#"+a.elementId+" "+this.props.targetSelector)}r&&(o||"comments_expand"!==t.type?("newpage"===t.type||t.newpage)&&(setImmediate(function(){e.props.children.forEach(function(t){"td-ads"===t.bundleName&&s(25).nukePosition(t.props.pos)})}),this.setState({expanded:!1})):setImmediate(function(){e.commentExpand(r)}))},componentDidMount:function(){s(59)("scroll",this._repositionAd,this)},componentWillUnmount:function(){s(207)("scroll",this._repositionAd)},_repositionAd:function(t,e){var i=this.props.targetIndex,n=s(10).findDOMNode(this.refs["adWrapper"+i]),o=s(10).findDOMNode(this.refs["adInnerWrapper"+i]),r=null;if(this.props.target){var p=document.getElementsByClassName(this.props.target);p&&p.length>i&&(r=p[i])}else if(this.props.targetSelector){var a=this.context.renderTarget;r=document.querySelector("#"+a.elementId+" "+this.props.targetSelector)}if(n&&o&&r){var d=o.offsetHeight,h=0;if(d>100||e){var c=r.getBoundingClientRect(),l=n.getBoundingClientRect(),g=!1,m=document.documentElement.clientWidth||window.innerWidth;if(c.top<88?c.bottom>=d+88?l.top<88&&(g=!0):h=c.height-d-(l.top-c.top):l.top<88?c.top>l.top?h=c.top-l.top:g=!0:c.top>l.top&&(h=c.top-l.top),g){this.setState({isFixed:!0,right:m-o.getBoundingClientRect().right})}else this.setState({isFixed:!1,offset:h})}}},render:function(){var t,e=this;if(e.state.childReady){t=(this.getStore("PageStore").getComposite(this.props.id)||{}).components}else t=this.props.children.map(function(t){return e.state.childReady||"td-ads"===t.bundleName?t:{bundleName:"tdv2-applet-swisschamp",name:"Empty",props:{}}});t.splice(this.state.childCount);for(var n=this.props.targetIndex?this.props.targetIndex:0,o=[],r=[],p=0,a=0;a<t.length;a++)t[a].props=t[a].props||{},t[a].props.id=t[a].props.id||"dockedAds-"+a,t[a].props.key=t[a].props.key||"dockedAds-"+a;for(a=0;a<t.length&&"td-ads"===t[a].bundleName;a++){var d=this.adStore.getPosConfig(t[a].props.pos)||{};d&&d.h&&(p+=parseInt(d.h,10)),o.push(t[a])}o.length>0&&o.length<t.length&&(r=t.slice(o.length));var h=this.props.className;h?h+=" ad-inner-wrapper":h="ad-inner-wrapper";var c={};this.state.isFixed?c={position:"fixed",right:this.state.right+"px",top:"88px"}:0!==this.state.offset&&(c={transform:"translate3d(0px, "+this.state.offset+"px, 0px)"});var l="ad-wrapper",g={};return this.state.expanded||(l+=" D(n)"),(!this.state.expanded||this.state.isFetching)&&r.length>0&&(g.height=p+"px"),s(1).createElement("div",{className:l,ref:"adWrapper"+n},s(1).createElement("div",{className:this.props.className,style:c,ref:"adInnerWrapper"+n},s(1).createElement("div",{style:g},s(1).createElement(i,{components:o})),s(1).createElement(i,{components:r})))}})}});